# syb-circuits

Zero-knowledge circuits for Tokamak's Sybil Resistance system, built with [Circom](https://docs.circom.io/).

## Overview

This repository contains circuits for maintaining a graph-based sybil resistance mechanism using Sparse Merkle Trees. The v2 circuits focus on efficient graph tree updates with cryptographic commitments to graph structure.

### TODOs

- [X] `NodeHasher`
- [X] `GraphTreeUpdate`
- [ ] `GraphTreeDelete`
- [ ] `ScoreTreeUpdate`
- [ ] Update `proveScoreInclusion` if needed.

## Installation

```bash
npm install
```

## Testing

Run all tests:
```bash
npm run test:all
```

Run a specific test file:

e.g.,
```bash
npm run test test/v2/nodeHasher.test.js
```

## Verifier Contract Generation

Generate Solidity verifier contracts for proof verification on-chain:

```bash
npm run verifier
```

This creates verifier contracts in the `verifiers/` directory that can be deployed to verify zero-knowledge proofs generated by the circuits.

## Project Structure

```
circuits/
  └── syb_rollup_v2/          # V2 graph tree circuits
      ├── graph_tree_update.circom
      ├── node_hasher.circom
      └── lib/
          └── is_in_array.circom
test/
  └── v2/                      # V2 circuit tests
      ├── graphTreeUpdate.test.js
      ├── nodeHasher.test.js
      └── lib/
verifiers/                     # Generated Solidity verifiers
build/                         # Compiled circuits and keys
```

## Development

Built with:
- [Circom 2.0](https://docs.circom.io/)
- [circomlib](https://github.com/iden3/circomlib) for Poseidon hashing and SMT operations
- [circomkit](https://github.com/erhant/circomkit) for circuit and testing
